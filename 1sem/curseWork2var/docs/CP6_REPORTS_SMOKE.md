# CP6 Reports Smoke Test

- Предусловия:
  - Установлена виртуальная среда (venv) и она активирована.
  - Установлены зависимости: `pip install -r requirements.txt`.
  - Есть доступ к Postgres (пользователь/пароль/хост/порт/база) и схема с таблицами клиентов, книг, book_types и журналом выдач.

- Запуск:
  - `python -m app`

- Проверка отчётов (admin и user):
  - ОТЧЕТЫ → Активные выдачи:
    * Что видно: список активных выдач с колонками, указанными в выборке (client, book, issued_at, due_at и т.п.).
    * Фильтры дат: введите допустимые даты в формате `YYYY-MM-DD` — данные фильтруются корректно.
    * Неверный формат даты: появится предупреждение "Неверный формат даты" и загрузка не выполняется.
    * Перевёрнутый диапазон (Дата с > Дата по): появится предупреждение и загрузка не выполняется.
    * Сброс: кнопка "Сброс" очищает фильтры и восстанавливает полный список.
    * Заголовок окна: показывает количество строк загруженного отчёта.
    * Экспорт: сохраняет текстовый файл с таблицей и заголовком/фильтрами.
  - ОТЧЕТЫ → Штрафы:
    * Поведение аналогично Active Loans.
    * Примечание: фильтр дат относится к полю `returned_at` (то есть даты возврата используются для ограничения выборки).

- Проверка экспорта:
  - Куда сохраняется: при выборе места сохранения укажите папку; если не добавили расширение, к имени автоматически приписывается `.txt`.
  - В начале файла: первая строка `Generated: YYYY-MM-DD`, далее строки с применёнными фильтрами (Date from / Date to), пустая строка и затем текстовая таблица.

- Troubleshooting:
  - "Пусто" (нет данных): проверьте, что в журнале есть актуальные записи; снимите фильтры или расширьте диапазон дат.
  - "Ошибка даты": убедитесь, что формат `YYYY-MM-DD`, и что `Дата с` ≤ `Дата по`.
  - "Нет колонок в журнале": если у вас кастомная таблица журнала без ожидаемых колонок, отчёты могут скрывать/не отображать некоторые поля — проверьте схему журнала и соответствие ожидаемых колонок (issued_at, returned_at, client_id, book_id и т.д.).

- Py_compile (локальная проверка синтаксиса):
  - `python3 -m py_compile app/*.py app/ui/*.py app/ui/reports/*.py app/repos/*.py`

- Troubleshooting (дополнительно):
  - Если не подключается к БД: проверьте `app/config.py` (настройки подключения), убедитесь, что Postgres запущен и доступен по хосту/порту, и проверьте логи/права пользователя.
  - Если нет данных в отчёте: проверьте, что таблицы заполнены (journal/loans), отключите фильтры в UI или проверьте схему и содержимое таблиц через psql/pgAdmin.
